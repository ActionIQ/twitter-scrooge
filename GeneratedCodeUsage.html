
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Generated Scala Code Usage &#8212; Scrooge 22.7.0 documentation</title>
    <link rel="stylesheet" href="_static/scrooge.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Implementation Semantics" href="Semantics.html" />
    <link rel="prev" title="Dependencies of the generated code" href="CodeGenDep.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="_static/small_flask.css" type= "text/css" rel="stylesheet" />

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Semantics.html" title="Implementation Semantics"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="CodeGenDep.html" title="Dependencies of the generated code"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Scrooge</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="generated-scala-code-usage">
<h1>Generated Scala Code Usage<a class="headerlink" href="#generated-scala-code-usage" title="Permalink to this headline">¶</a></h1>
<p>This section explains how to work with the Scala code that Scrooge generates.</p>
<div class="section" id="unions">
<h2>Unions<a class="headerlink" href="#unions" title="Permalink to this headline">¶</a></h2>
<p>Scrooge generates Scala case classes that can be used to construct union instances. Consider the following union which may have a string value or a User struct value:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="mi">1</span><span class="k">:</span> <span class="kt">i64</span> <span class="kt">id</span>
    <span class="mi">2</span><span class="k">:</span> <span class="kt">string</span> <span class="kt">name</span>
<span class="o">}</span>

<span class="n">union</span> <span class="nc">Visitor</span> <span class="o">{</span>
  <span class="mi">1</span><span class="k">:</span> <span class="kt">string</span> <span class="kt">guestName</span>
  <span class="mi">2</span><span class="k">:</span> <span class="kt">User</span> <span class="kt">user</span>
<span class="o">}</span>
</pre></div>
</div>
<p>To create an instance of Visitor, use the case classes named for each field:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nc">Visitor</span><span class="o">.</span><span class="nc">GuestName</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span><span class="o">)</span>
<span class="nc">Visitor</span><span class="o">.</span><span class="nc">User</span><span class="o">(</span><span class="nc">User</span><span class="o">(</span><span class="mi">123L</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span><span class="o">))</span>
</pre></div>
</div>
<p>The case classes for union fields can be used to access values in a typesafe way via pattern matching:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">v</span><span class="k">:</span> <span class="kt">Visitor</span> <span class="o">=</span> <span class="nc">Visitor</span><span class="o">.</span><span class="nc">GuestName</span><span class="o">(</span><span class="s">&quot;Erica&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">displayName</span> <span class="k">=</span> <span class="n">v</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Visitor</span><span class="o">.</span><span class="nc">GuestName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="s">&quot;guest &quot;</span> <span class="o">+</span> <span class="n">name</span>
  <span class="k">case</span> <span class="nc">Visitor</span><span class="o">.</span><span class="nc">User</span><span class="o">(</span><span class="n">u</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Because new fields can be added to unions, Scrooge provides UnknownUnionField which should be used for compatibility with newer versions:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">displayName</span> <span class="k">=</span> <span class="n">v</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Visitor</span><span class="o">.</span><span class="nc">GuestName</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="s">&quot;guest &quot;</span> <span class="o">+</span> <span class="n">name</span>
  <span class="k">case</span> <span class="nc">Visitor</span><span class="o">.</span><span class="nc">User</span><span class="o">(</span><span class="n">u</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span>
  <span class="k">case</span> <span class="nc">Visitor</span><span class="o">.</span><span class="nc">UnknownUnionField</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="s">&quot;unknown visitor&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Note that you must use the provided extractors when pattern matching against unions; you cannot use the constructors for structs themselves. The following will fail with a MatchError:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">userVisitor</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">User</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">name</span>
  <span class="k">case</span> <span class="n">s</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=&gt;</span> <span class="n">s</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="optional-functionality">
<h2>Optional functionality<a class="headerlink" href="#optional-functionality" title="Permalink to this headline">¶</a></h2>
<p>For <cite>struct</cite>s, you can opt into generating
<a class="reference external" href="https://en.wikipedia.org/wiki/Proxy_pattern">proxy classes</a>. The generated code
delegates to another instance. These may be useful for tests and otherwise.</p>
<p>Given the IDL:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="nc">User</span> <span class="o">{</span>
  <span class="mi">1</span><span class="k">:</span> <span class="kt">i64</span> <span class="kt">id</span>
  <span class="mi">2</span><span class="k">:</span> <span class="kt">string</span> <span class="kt">name</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Add the annotation.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">struct</span> <span class="nc">User</span> <span class="o">{</span>
  <span class="mi">1</span><span class="k">:</span> <span class="kt">i64</span> <span class="kt">id</span>
  <span class="mi">2</span><span class="k">:</span> <span class="kt">string</span> <span class="kt">name</span>
<span class="o">}</span> <span class="o">(</span><span class="n">com</span><span class="o">.</span><span class="n">twitter</span><span class="o">.</span><span class="n">scrooge</span><span class="o">.</span><span class="n">scala</span><span class="o">.</span><span class="n">generateStructProxy</span> <span class="k">=</span> <span class="s">&quot;true&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>Which generates the following code on the companion <cite>User</cite> object,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">Proxy</span> <span class="k">extends</span> <span class="nc">User</span> <span class="o">{</span>
  <span class="k">protected</span> <span class="k">def</span> <span class="nc">_underlying_User</span><span class="k">:</span> <span class="kt">User</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="nc">_underlying_User</span><span class="o">.</span><span class="n">id</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">_underlying_User</span><span class="o">.</span><span class="n">name</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nc">_passthroughFields</span><span class="k">:</span> <span class="kt">immutable$Map</span><span class="o">[</span><span class="kt">Short</span>, <span class="kt">TFieldBlob</span><span class="o">]</span> <span class="k">=</span> <span class="nc">_underlying_User</span><span class="o">.</span><span class="nc">_passthroughFields</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Then, for example, <cite>Proxy</cite> can then be used in the following manner,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">alwaysFifty</span><span class="k">:</span> <span class="kt">User</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">.</span><span class="nc">Proxy</span> <span class="o">{</span>
  <span class="k">protected</span> <span class="k">def</span> <span class="nc">_underlying_User</span><span class="k">:</span> <span class="kt">User</span> <span class="o">=</span> <span class="n">aUserInstance</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">50</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="codecs-and-metadata">
<h2>Codecs and Metadata<a class="headerlink" href="#codecs-and-metadata" title="Permalink to this headline">¶</a></h2>
<p>When you write code that works with a particular set of Scrooge-generated classes,
you know statically what fields do they have and what are their types. You also
have access to those classes’ <cite>ThriftStructCodec</cite> simply as the companion object to
the struct class. However, if you write code that generally works with any Scrooge-generated
structs, Scrooge gives you APIs to obtain both their codec and the metadata describing their
fields. (Unions are structs too, so everything that applies to structs applies to unions as
well.)</p>
<div class="section" id="how-to-get-the-codec-for-a-struct-class">
<h3>How to get the codec for a struct class<a class="headerlink" href="#how-to-get-the-codec-for-a-struct-class" title="Permalink to this headline">¶</a></h3>
<p>To get a <cite>com.twitter.scrooge.ThriftStructCodec</cite> for any struct class, use the
<cite>ThriftStructCodec.forStructClass(Class)</cite> method. Pass it the runtime class of a
Scrooge-generated struct and it will return its codec object:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">structionize</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">ThriftStruct</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">codec</span> <span class="k">=</span> <span class="nc">ThriftStructCodec</span><span class="o">.</span><span class="n">forStructClass</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">getClass</span><span class="o">)</span>
  <span class="o">...</span> <span class="n">use</span> <span class="n">the</span> <span class="n">codec</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Codecs have <cite>encode</cite> and <cite>decode</cite> methods as well as a <cite>metaData</cite> method that returns a
<cite>com.twitter.scrooge.ThriftStructMetaData</cite> object describing the structure in detail.</p>
</div>
<div class="section" id="how-to-get-metadata-for-a-struct-class">
<h3>How to get metadata for a struct class<a class="headerlink" href="#how-to-get-metadata-for-a-struct-class" title="Permalink to this headline">¶</a></h3>
<p>You can also obtain the metadata object directly using the
<cite>ThriftStructMetaData.forStructClass(Class)</cite> method. Metadata describes the struct, most notably
providing access to information about its fields (<cite>fieldInfos</cite> for structs and <cite>unionFields</cite>
for unions) as well as access to annotations with the <cite>structAnnotations</cite> method. The <cite>fields</cite>
method (separate from <cite>fieldInfos</cite>) provides access to <cite>ThriftStructField</cite> objects that most
notably expose a <cite>getValue</cite> method allowing you to retrieve the field value from a struct instance.
For example, to read an arbitrary named field’s value you could use a method like this below:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">readFieldValue</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">s</span><span class="k">:</span> <span class="kt">ThriftStruct</span><span class="o">,</span> <span class="n">fieldName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">metaData</span> <span class="k">=</span> <span class="nc">ThriftStructMetaData</span><span class="o">.</span><span class="n">forStructClass</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">getClass</span><span class="o">)</span>
  <span class="n">metaData</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">collectFirst</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">f</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">fieldName</span> <span class="k">=&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">getValue</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>To get field annotations for a particular field you could use a method such as:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">getFieldAnnotations</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">ThriftStruct</span><span class="o">,</span> <span class="n">fieldName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">metaData</span> <span class="k">=</span> <span class="nc">ThriftStructMetaData</span><span class="o">.</span><span class="n">forStructClass</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">getClass</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">annOpt</span> <span class="k">=</span> <span class="n">metaData</span><span class="o">.</span><span class="n">fieldInfos</span><span class="o">.</span><span class="n">collectFirst</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">f</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">tfield</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">fieldName</span> <span class="k">=&gt;</span> <span class="n">f</span><span class="o">.</span><span class="n">fieldAnnotations</span>
  <span class="o">}</span>
  <span class="n">annOpt</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="nc">Empty</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-retrieve-field-information-for-a-union-arm">
<h3>How to retrieve field information for a union arm<a class="headerlink" href="#how-to-retrieve-field-information-for-a-union-arm" title="Permalink to this headline">¶</a></h3>
<p>Unions have one more special method. In Scrooge, union arms are represented as
subclasses of a top-level class representing the union itself. The
<cite>com.twitter.scrooge.ThriftStructFieldInfo</cite> for a particular arm can be accessed
using <cite>ThriftUnion.fieldInfoForUnionClass(Class)</cite> method. It is equivalent to calling
the <cite>unionStructFieldInfo</cite> on an instance of the union, but is helpful if you don’t have
an instance of a union arm, just its runtime <cite>Class</cite> object. For example, if you have
an instance of a union arm, you can get all of its annotations using</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">unionArmAnnotations</span><span class="o">(</span><span class="n">u</span><span class="k">:</span> <span class="kt">ThriftUnion</span><span class="o">)</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="n">u</span><span class="o">.</span><span class="n">unionStructFieldInfo</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">fieldAnnotations</span><span class="o">).</span><span class="n">getOrElse</span><span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="nc">Empty</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>However, if all you have is a runtime class for it, then you can use the class-specific
method:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">unionArmAnnotations</span><span class="o">(</span><span class="n">uc</span><span class="k">:</span> <span class="kt">Class</span><span class="o">[</span><span class="k">_</span> <span class="k">&lt;:</span> <span class="kt">ThriftUnion</span><span class="o">])</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="nc">ThriftUnion</span><span class="o">.</span><span class="n">fieldInfoForUnionClass</span><span class="o">(</span><span class="n">uc</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">fieldAnnotations</span><span class="o">).</span><span class="n">getOrElse</span><span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="nc">Empty</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>(Note in above examples, both methods return an <cite>Option[ThriftStructFieldInfo]</cite> - if you pass
the instance/class representing the overall union, and not a specific arm, they return <cite>None</cite>.)</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/scrooge.png" alt="Logo"/>
            </a></p><a href="index.html"><h3>Scrooge</h3></a>
<p>
  Scrooge is a general purpose thrift parser/generator
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://github.com/twitter/scrooge">Scrooge @ GitHub</a></li>
  <li><a href="https://github.com/twitter/scrooge/issues">Issue Tracker</a></li>
</ul>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Generated Scala Code Usage</a><ul>
<li><a class="reference internal" href="#unions">Unions</a></li>
<li><a class="reference internal" href="#optional-functionality">Optional functionality</a></li>
<li><a class="reference internal" href="#codecs-and-metadata">Codecs and Metadata</a><ul>
<li><a class="reference internal" href="#how-to-get-the-codec-for-a-struct-class">How to get the codec for a struct class</a></li>
<li><a class="reference internal" href="#how-to-get-metadata-for-a-struct-class">How to get metadata for a struct class</a></li>
<li><a class="reference internal" href="#how-to-retrieve-field-information-for-a-union-arm">How to retrieve field information for a union arm</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="CodeGenDep.html" title="previous chapter">Dependencies of the generated code</a></li>
      <li>Next: <a href="Semantics.html" title="next chapter">Implementation Semantics</a></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright 2013 Twitter, Inc.
    Created using <a href="https://www.sphinx-doc.org/en/master/">Sphinx</a>.
  </div>
  
  </body>
</html>